<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button  [routerLink]="['/']" ></ion-back-button>
    </ion-buttons>
    <ion-title> {{'start.accountregister' | translate}}</ion-title>

    <span class="border-bottom-part-one"></span>
    <span class="border-bottom-part-two"></span>
    <span class="border-bottom-part-three"></span>
    <span class="border-bottom-part-four"></span>
  </ion-toolbar>

</ion-header>

<ion-content [fullscreen]="true">
  
  <div class="content-center">
    
    <form id="registerFormId"  #registerForm="ngForm" (ngSubmit)="onSubmit()" >

      <!--
      @if( this.error ){
        <ng-container [ngTemplateOutlet]="errorTemplate"></ng-container>
      }

      <ng-template #errorTemplate>
        <ion-text>{{ error }}</ion-text>
      </ng-template>
      -->
      <ion-row>
        <ion-col>
          <ion-select label="{{'register.accounttype' | translate}}" 
                      label-placement="floating" 
                      fill="outline"
                      required
                      [(ngModel)]="accountSignUp.account_type"
                      #account_type="ngModel"
                      color="secondary"
                      name="account_type"
                      [value]="1"
                      >
            <ion-select-option [value]="1" translate>user</ion-select-option>
            <ion-select-option [value]="2" translate>market</ion-select-option>
            <ion-select-option [value]="3" translate>restaurant</ion-select-option>
            <ion-select-option [value]="4" translate>medicine</ion-select-option>
          </ion-select>
        </ion-col>
      </ion-row>

      <ion-row >
        
        <ion-col>
            <ion-input
              label-placement="floating" 
              placeholder="{{'register.enteraccountname' | translate}}"
              label="{{'register.accountname' | translate}}"
              counter="true"
              maxlength="50"
              [(ngModel)]="accountSignUp.account_name"
              #account_name="ngModel"
              name="account_name"
              required
              color="secondary"
            >
          </ion-input>
          @if ( account_name!.invalid && ( account_name!.dirty || account_name!.touched)) {

            @if (account_name!.errors?.['required']) {
              <ng-container [ngTemplateOutlet]="account_nameTemplateRequired"></ng-container>
            }
            
          }
    
          <ng-template #account_nameTemplateRequired>
            <ion-text class="error-text" color="danger"><small>{{'register.accountnamereq' | translate}}</small></ion-text>
          </ng-template>
     
        </ion-col>  

      </ion-row>


      <ion-row >
        
        <ion-col>
            <ion-input
              label-placement="floating" 
              placeholder="{{'register.placeholderlogin' | translate}}"
              label="{{'register.login' | translate}}"
              counter="true"
              maxlength="50"
              [(ngModel)]="accountSignUp.login"
              #login="ngModel"
              name="login"
              required
              color="secondary"
              appRegexPattern="^([_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,5}))|\d+$"
              [ngModelOptions]="{ updateOn: 'blur' }"
              IsUniqueValidate
            >
            @if (login!.pending){
              <ion-spinner slot="end"></ion-spinner>
            }

          </ion-input>
          @if (login!.invalid && (login!.touched || login!.dirty)) {

            @if (login!.errors?.['required']) {
              <ng-container [ngTemplateOutlet]="loginTemplateRequired"></ng-container>
            }
    
            @if (login!.errors?.['forbiddenName']?.value !== '' && !login!.errors?.['notUnique']) {
              <ng-container [ngTemplateOutlet]="loginTemplatePattern"></ng-container>
            }
    
            @if(login!.errors?.['notUnique']){
              <ng-container [ngTemplateOutlet]="loginTemplateExists"></ng-container>
            }
            
          }
    
          <ng-template #loginTemplateRequired>
            <ion-text class="error-text" color="danger"><small>{{'register.loginreq' | translate}}</small></ion-text>
          </ng-template>
    
          <ng-template #loginTemplatePattern>
            <ion-text class="error-text" color="danger"><small>{{'register.loginreqpattern' | translate}}</small></ion-text>
          </ng-template>
    
          <ng-template #loginTemplateExists>
            <ion-text class="error-text" color="danger"><small>{{'register.loginduplicate' | translate}}</small></ion-text>
          </ng-template>

        </ion-col>  

      </ion-row>


    
      <ion-row >
        
        <ion-col>
            <ion-input
              label-placement="floating" 
              placeholder="{{'register.enterfirstname' | translate}}"
              label="{{'register.firstname' | translate}}"
              counter="true"
              maxlength="50"
              [(ngModel)]="accountSignUp.firstName"
              #firstName="ngModel"
              name="firstName"
              required
              color="secondary"
            ></ion-input>

            @if ( firstName!.invalid && ( firstName!.dirty || firstName!.touched)) {

              @if (firstName!.errors?.['required']) {
                <ng-container [ngTemplateOutlet]="firstNameTemplateRequired"></ng-container>
              }
              
            }
      
            <ng-template #firstNameTemplateRequired>
              <ion-text class="error-text" color="danger"><small>{{'register.firstnamereq' | translate}}</small></ion-text>
            </ng-template>

        </ion-col>  

      </ion-row>


      <ion-row >
            
            <ion-col>
                <ion-input
                  label-placement="floating" 
                  placeholder="{{'register.enterlastname' | translate}}"
                  label="{{'register.lastname' | translate}}"
                  counter="true"
                  maxlength="50"
                  [(ngModel)]="accountSignUp.lastName"
                  #lastName="ngModel"
                  name="lastName"
                  required
                  color="secondary"
                ></ion-input>

                          
                @if (lastName!.invalid && (lastName!.touched || lastName!.dirty)) {

                  @if (lastName!.errors?.['required']) {
                    <ng-container [ngTemplateOutlet]="lastNameTemplateRequired"></ng-container>
                  }
                  
                }
                
                <ng-template #lastNameTemplateRequired>
                  <ion-text class="error-text" color="danger"><small>{{'register.lastnamereq' | translate}}</small></ion-text>
                </ng-template>
            </ion-col>  

      </ion-row>

      <ion-row >
        
        <ion-col>
            <ion-input
              label-placement="floating" 
              placeholder="{{'register.placeholderphone' | translate}}"
              label="{{'register.phone' | translate}}"
              counter="true"
              maxlength="30"
              [(ngModel)]="accountSignUp.phone"
              #phone="ngModel"
              name="phone"
              required
              color="secondary"
              appRegexPattern="^\d{11}$"
            >

          </ion-input>
          @if (phone!.invalid && (phone!.touched || phone!.dirty)) {

            @if (phone!.errors?.['required']) {
              <ng-container [ngTemplateOutlet]="phoneTemplateRequired"></ng-container>
            }
    
            @if (login!.errors?.['forbiddenName']?.value !== '' ) {
              <ng-container [ngTemplateOutlet]="phoneTemplatePattern"></ng-container>
            }
            
          }
    
          <ng-template #phoneTemplateRequired>
            <ion-text class="error-text" color="danger"><small>{{'register.loginreq' | translate}}</small></ion-text>
          </ng-template>
    
          <ng-template #phoneTemplatePattern>
            <ion-text class="error-text" color="danger"><small>{{'register.phonereqpattern' | translate}}</small></ion-text>
          </ng-template>


        </ion-col>  

      </ion-row>


      <ion-row >
        
        <ion-col>
            <ion-input
              label-placement="floating" 
              placeholder="{{'register.enteremail' | translate}}"
              label="{{'register.email' | translate}}"
              counter="true"
              maxlength="50"
              [(ngModel)]="accountSignUp.email"
              #email="ngModel"
              name="email"
              email
              color="secondary"
            ></ion-input>

            
            @if (email!.invalid && (email!.touched || email!.dirty)) {

              @if (email!.errors?.['email']) {
                <ng-container [ngTemplateOutlet]="emailTemplatePattern"></ng-container>
              }

            }

            <ng-template #emailTemplatePattern>
              <ion-text class="error-text" color="danger"><small>{{'register.emailpattern' | translate}}</small></ion-text>
            </ng-template>
            
        </ion-col>  

      </ion-row>


      <ion-row>
        <ion-col>
          <ion-select   aria-label="language" 
                        interface="popover" 
                        placeholder="{{'register.selectlanguage' | translate}}" 
                        [(ngModel)]="accountSignUp.s_cut"
                        #s_cut="ngModel"
                        name="s_cut"
                        required
                        >

            @for (lang of appLanguages;track lang.name){
              <ion-select-option [value]="lang?.key">  {{ lang.name }} </ion-select-option>
            }

          </ion-select>
          @if (s_cut!.invalid && (s_cut!.touched || s_cut!.dirty)) {

            @if (s_cut!.errors?.['required']) {
              <ng-container [ngTemplateOutlet]="s_cutTemplateRequired"></ng-container>
            }
    
          }

          <ng-template #s_cutTemplateRequired>
            <ion-text class="error-text" color="danger"><small translate="register.languagereq"></small></ion-text>
          </ng-template>

        </ion-col>
      </ion-row>

      <ion-row >
        <ion-col>
          <ion-input
            label-placement="floating" 
            placeholder="{{'register.enterpassword' | translate}}"
            label="{{'register.password' | translate}}"
            counter="true"
            maxlength="20"
            required
            [type]="hide ? 'password' : 'text'"
            [(ngModel)]="accountSignUp.password"
            #password="ngModel"
            name="password"
            minlength="6"
            color="secondary"
          >
          @if (password!.value !== '') {
            <ion-icon slot="end" [name]="hide ? 'eye' : 'eye-off'" (click)="hide = !hide"></ion-icon>
          }
          </ion-input>

                
            @if (password!.invalid && (password!.touched || password!.dirty)) {
              @if (password!.errors?.['required']) {
                <ng-container [ngTemplateOutlet]="passwordTemplateRequired"></ng-container>
              }
            }
          
            <ng-template #passwordTemplateRequired>
              <ion-text class="error-text" color="danger"><small translate>register.passwordreq</small> </ion-text>
            </ng-template>
          
        </ion-col>
    
      </ion-row>



      <ion-row>
        <ion-col>
          <ion-button [disabled]="!registerForm.valid" 
                      type="submit" 
                      color="secondary" 
                      expand="block" 
                      translate="register.registeraccount" 
                      class="submit-button">
             @if(isLoading) {<ion-spinner class="spinner-button"></ion-spinner>}
            </ion-button>
        </ion-col>
      </ion-row>

    </form>

  </div> 
</ion-content>
